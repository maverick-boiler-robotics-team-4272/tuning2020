<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="smoothie.js"></script>
  <script type="text/javascript" src="jquery-3.3.1.js"></script>
  <script src="/networktables/camera.js"></script>
  <script src="/networktables/networktables.js"></script>
  <script type="text/javascript">

    var velocitySeries = new TimeSeries();
    var motorOutputSeries = new TimeSeries();
    var intakeSeries = new TimeSeries();
	
    NetworkTables.addKeyListener("/datatable/ShooterVelocity", function (key, value, isNew) {
      velocitySeries.append(new Date().getTime(), value);
	  document.getElementById("RightReadout").innerText = value;
	  document.getElementById("RightMinVal").innerText = velocitySeries.minValue;
	  document.getElementById("RightMaxVal").innerText = velocitySeries.maxValue;
    }, true);
	
	NetworkTables.addKeyListener("/datatable/ShooterOutput", function (key, value, isNew) {
		motorOutputSeries.append(new Date.getTime(), value);
		document.getElementById("rightOutReadout").innerText = value;
	}, true);
	
	NetworkTables.addKeyListener("/datatable/ShooterVelocitySetPoint", function (key, value, isNew) {
      document.getElementById("rightSetpointReadout").innerText = value;
	}, true);
	
	NetworkTables.addKeyListener("/datatable/drivekP", function (key, value, isNew) {
      document.getElementById("kp").value = value;
	}, true);

	NetworkTables.addKeyListener("/datatable/drivekI", function (key, value, isNew) {
      document.getElementById("ki").value = value;
	}, true);
	
	NetworkTables.addKeyListener("/datatable/drivekD", function (key, value, isNew) {
      document.getElementById("kd").value = value;
	}, true);
	
	NetworkTables.addKeyListener("/datatable/drivekF", function (key, value, isNew) {
      document.getElementById("kff").value = value;
	}, true);
	
	
    setInterval(function () {
      velocitySeries.append(new Date().getTime(), NetworkTables.getValue("/datatable/rightDriveVelocity"));
    }, 10);
	
	setInterval(function () {
	  motorOutputSeries.append(new Date().getTime(), NetworkTables.getValue("/datatable/rightDriveOutput"));
	}, 10);
	
    function onLoad() {
      var shooterChart = new SmoothieChart({ millisPerPixel: 8, maxValue: 5000, minValue: -100 });
      shooterChart.addTimeSeries(velocitySeries, { strokeStyle: 'rgba(255, 255, 0, 1)', lineWidth: 4 });
	  shooterChart.streamTo(document.getElementById("rightVelocity"), 100);
	  
	  var motorOutputChart = new SmoothieChart({millisPerPixel: 8, maxValue: 1.0, minValue: -0.1 });
	  motorOutputChart.addTimeSeries(motorOutputSeries, { strokeStyle: 'rgba(255, 255, 0, 1)', lineWidth: 4 });
	  motorOutputChart.streamTo(document.getElementById("rightOutput"), 100);
	  

    }
	
	function submitMotorValue() {
      var kp = parseFloat(document.getElementById("kp").value);
      var ki = parseFloat(document.getElementById("ki").value);
      var kd = parseFloat(document.getElementById("kd").value);
      var kff = parseFloat(document.getElementById("kff").value);
      NetworkTables.putValue("/datatable/drivekP", kp);
      NetworkTables.putValue("/datatable/drivekI", ki);
      NetworkTables.putValue("/datatable/drivekD", kd);
      NetworkTables.putValue("/datatable/drivekF", kff);
    }

  </script>
</head>

<body onload="onLoad()">
<table border="1">
<tr>
  <td>Right Velocity: <span id=readout></span>
  <br/>
  <canvas id="rightVelocity" width="1200" height="150"></canvas>
  <br /></td>
  <td><p>current setpoint: <span id=RightReadout></span></p>
  <p>min value on graph: <span id=rightMinVal></span></p>
  <p>max value on graph: <span id=rightMaxVal></span></p></td>
 </tr>
 <tr>
 <td>
  Right motor output: <span id=rightOutReadout></span>
  <br />
  <canvas id="rightOutput" width="1200" height="100"></canvas>
  <br /></td>
 </tr>
  </table>
  
  <strong>PID Values:</strong><br/>
          P:
          <input id="kp" step="0.001" type="number">
          <br>
          I:
          <input id="ki" step="0.001" type="number">
          <br>
          D:
          <input id="kd" step="0.001" type="number">
          <br>
          FF:
          <input id="kff" step="0.001" type="number">
          <br>
          <button id="submitMotorPID" type="button" onclick="submitMotorValue()">Update Motor PID</button>
  
  

</html>